name: Entur/Slack/CI

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  update-post-doc:
    uses: entur/gha-meta/.github/workflows/auto-doc.yml@v1.0.0
    with:
      workflow_file: .github/workflows/post.yml
      readme_file: README-post.md

  test-post-message:
    uses: ./.github/workflows/post.yml
    with:
      channel: "C01AVRY6Q23" # notify-plattform
      message: "Hello from gha-slack CI-workflow!"
    secrets: inherit

  test-post-message-with-blocks:
    uses: ./.github/workflows/post.yml
    with:
      channel: "C01AVRY6Q23" # notify-plattform
      blocks: |
        {"blocks": [{"type": "section","text": {"type": "mrkdwn","text": "*Hello from gha-slack CI!* :rocket:"}},{"type": "divider"},{"type": "section","fields": [{"type": "mrkdwn","text": "*Repository:*\n<https://github.com/entur/gha-slack|gha-slack>"},{"type": "mrkdwn","text": "*Branch:*\n${{ github.ref_name }}"}]}]}
    secrets: inherit
